generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String  @id @default(uuid())
  name     String
  email    String  @unique
  password String? //null if Google user
  googleId String? @unique
  plan     String? @default("free")

  // Business Profile
  businessName    String?
  businessAddress String?
  businessPhone   String?
  currency        String? @default("USD")
  logoUrl         String?

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  invoices  Invoice[]
  Customer  Customer[]
}

model Customer {
  id     String  @id @default(uuid())
  userId String
  name   String
  phone  String?
  email  String?

  user     User      @relation(fields: [userId], references: [id])
  invoices Invoice[]
}

model Invoice {
  id         String @id @default(uuid())
  userId     String
  customerId String
  subtotal   Float
  tax        Float
  total      Float
  status     String @default("pending")
  paymentStatus String @default("pending") // pending, paid, failed
  paymentLink   String?
  whatsappStatus String @default("not_sent") // not_sent, sent, failed
  stripePaymentIntentId String?

  user     User          @relation(fields: [userId], references: [id])
  customer Customer      @relation(fields: [customerId], references: [id])
  items    InvoiceItem[]
}

model InvoiceItem {
  id        String @id @default(uuid())
  invoiceId String
  name      String
  qty       Int
  price     Float

  invoice Invoice @relation(fields: [invoiceId], references: [id])
}
